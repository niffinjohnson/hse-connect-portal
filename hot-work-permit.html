<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Hot Work Permit - HSE Connect</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #f0f0f0;
    padding: 20px;
}

.permit {
    background: white;
    max-width: 1200px;
    margin: auto;
    padding: 10px;
    border: 2px solid #000;
}

h1 {
    text-align: center;
    margin: 5px 0;
    letter-spacing: 2px;
}

.banner {
    text-align: center;
    font-weight: bold;
    border: 1px solid #000;
    padding: 6px;
    margin-bottom: 10px;
    background: #ddd;
}

table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 10px;
}

td, th {
    border: 1px solid #000;
    padding: 5px;
    vertical-align: top;
    font-size: 13px;
}

.section-title {
    background: #eee;
    font-weight: bold;
    text-align: center;
}

input, textarea {
    width: 100%;
    border: none;
    font-size: 13px;
}

textarea {
    resize: vertical;
}

.checkbox-group label {
    display: block;
    font-weight: normal;
}

button {
    margin-top: 10px;
    width: 100%;
    padding: 10px;
    background: #d32f2f;
    color: white;
    border: none;
    font-weight: bold;
    cursor: pointer;
}

.message {
    margin-top: 10px;
    font-weight: bold;
}
</style>
</head>

<body>

<div class="permit">

<h1>AMPHENOL FCI</h1>
<h1>HOT WORK PERMIT</h1>

<div class="banner">
STOP â€“ Avoid hot work when possible. Consider using an alternative cold work method.
</div>

<form id="hotWorkForm">

<table>
<tr>
    <td width="50%">
        <b>Instruction for Permit Authorizer</b><br>
        1. Specify precautions.<br>
        2. Keep Part I during process.<br>
        3. Issue Part II to worker.<br>
        4. Monitor post work fire watch.<br>
        5. Sign off final check.
    </td>
    <td width="50%">
        <div class="section-title">Required Precautions</div>
        <div class="checkbox-group">
            <label><input type="checkbox" value="Fire pump operational"> Fire pump operational</label>
            <label><input type="checkbox" value="Control valves open"> Control valves open</label>
            <label><input type="checkbox" value="Extinguishers available"> Extinguishers available</label>
            <label><input type="checkbox" value="Equipment in good condition"> Equipment in good condition</label>
            <label><input type="checkbox" value="Shield combustibles within 35ft"> Shield combustibles within 35 ft</label>
            <label><input type="checkbox" value="Remove ignitable liquids"> Remove ignitable liquids</label>
            <label><input type="checkbox" value="Isolate equipment"> Isolate equipment</label>
            <label><input type="checkbox" value="Continuous fire watch"> Continuous fire watch</label>
        </div>
    </td>
</tr>
</table>

<table>
<tr>
    <td width="25%">Hot Work By</td>
    <td width="25%">
        <select id="workBy">
            <option>Employee</option>
            <option>Contractor</option>
        </select>
    </td>
    <td width="25%">Date</td>
    <td width="25"><input type="date" id="date"></td>
</tr>

<tr>
    <td>Job Number</td>
    <td><input type="text" id="jobNumber"></td>
    <td>Location</td>
    <td><input type="text" id="location"></td>
</tr>

<tr>
    <td colspan="4">Work to be Performed
        <textarea id="workDescription" rows="2"></textarea>
    </td>
</tr>

<tr>
    <td colspan="2">Name Performing Hot Work
        <input type="text" id="performer">
    </td>
    <td colspan="2">Name Performing Fire Watch
        <input type="text" id="fireWatchName">
    </td>
</tr>

<tr>
    <td colspan="2">Permit Authorizer (Name & Sign)
        <input type="text" id="authorizer">
    </td>
    <td>Permit Expiry Date</td>
    <td><input type="date" id="expiryDate"></td>
</tr>

<tr>
    <td colspan="4">Additional Required Precautions
        <textarea id="additionalPrecautions" rows="2"></textarea>
    </td>
</tr>
</table>

<button type="submit">SUBMIT PERMIT</button>

<div id="message" class="message"></div>

</form>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getAuth } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyDsFX7tQezhtJi6GkVBpZXn7YyJgZfyi7o",
  authDomain: "hse-connect-5b0a3.firebaseapp.com",
  projectId: "hse-connect-5b0a3",
  storageBucket: "hse-connect-5b0a3.firebasestorage.app",
  messagingSenderId: "1017230242361",
  appId: "1:1017230242361:web:66d427e171595aae5c53e8",
  measurementId: "G-2GGKDEJTKW"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

document.getElementById("hotWorkForm").addEventListener("submit", async (e) => {

    e.preventDefault();

    const user = auth.currentUser;
    if (!user) {
        alert("Login required.");
        return;
    }

    const precautions = [];
    document.querySelectorAll(".checkbox-group input:checked")
        .forEach(cb => precautions.push(cb.value));

    const permitData = {
        permitType: "Hot Work",
        workBy: document.getElementById("workBy").value,
        date: document.getElementById("date").value,
        jobNumber: document.getElementById("jobNumber").value,
        location: document.getElementById("location").value,
        workDescription: document.getElementById("workDescription").value,
        performer: document.getElementById("performer").value,
        fireWatchName: document.getElementById("fireWatchName").value,
        authorizer: document.getElementById("authorizer").value,
        expiryDate: document.getElementById("expiryDate").value,
        precautions: precautions,
        additionalPrecautions: document.getElementById("additionalPrecautions").value,
        createdBy: user.email,
        status: "Pending Approval",
        createdAt: serverTimestamp()
    };

    await addDoc(collection(db, "permits"), permitData);

    document.getElementById("message").innerHTML =
        "Permit submitted successfully.";

    e.target.reset();
});

</script>

</body>
</html>
