<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Hot Work Permit</title>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <style>
    body {
      font-family: Arial;
      background: #f4f6f8;
      padding: 30px;
      display: none;
    }

    .box {
      background: white;
      padding: 25px;
      max-width: 700px;
      margin: auto;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    label {
      display: block;
      margin-top: 12px;
      font-weight: bold;
    }

    input, textarea {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    button {
      margin-top: 20px;
      padding: 10px;
      width: 100%;
      background: #d9534f;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
  </style>
</head>

<body>

<div class="box">
  <h2>ðŸ”¥ Hot Work Permit</h2>

  <label>Work Description</label>
  <textarea id="description"></textarea>

  <label>Location</label>
  <input type="text" id="location">

  <label>Contractor Name</label>
  <input type="text" id="contractor">

  <label>Fire Watch Assigned (Yes/No)</label>
  <input type="text" id="firewatch">

  <label>Extinguishers Provided (Yes/No)</label>
  <input type="text" id="extinguisher">

  <button onclick="submitPermit()">Submit Permit</button>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDsFX7tQezhtJi6GkVBpZXn7YyJgZfyi7o",
    authDomain: "hse-connect-5b0a3.firebaseapp.com",
    projectId: "hse-connect-5b0a3",
    storageBucket: "hse-connect-5b0a3.firebasestorage.app",
    messagingSenderId: "1017230242361",
    appId: "1:1017230242361:web:66d427e171595aae5c53e8"
  };

  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.firestore();

  auth.onAuthStateChanged(async (user) => {
    if (!user) {
      window.location.href = "index.html";
      return;
    }
    document.body.style.display = "block";
  });

  async function submitPermit() {

    const user = auth.currentUser;

    const permitData = {
      type: "Hot Work",
      description: document.getElementById("description").value,
      location: document.getElementById("location").value,
      contractor: document.getElementById("contractor").value,
      fireWatch: document.getElementById("firewatch").value,
      extinguisher: document.getElementById("extinguisher").value,
      status: "Pending",
      createdBy: user.email,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    };

    await db.collection("permits").add(permitData);

    alert("Hot Work Permit Submitted Successfully");
    window.location.href = "dashboard.html";
  }
</script>

</body>
</html>
