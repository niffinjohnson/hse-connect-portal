<!DOCTYPE html>
<html>
<head>
  <title>Safety Tip</title>
  <meta charset="UTF-8">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f4f6f8;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    .card {
      background: white;
      padding: 40px;
      width: 500px;
      border-radius: 10px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      text-align: center;
    }

    h2 {
      margin-bottom: 20px;
    }

    #tipText {
      font-size: 18px;
      margin-bottom: 25px;
    }

    button {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
    }

    .editBtn {
      background-color: #2b6cb0;
      color: white;
    }

    .saveBtn {
      background-color: #2f855a;
      color: white;
      margin-top: 10px;
    }

    textarea {
      width: 100%;
      height: 80px;
      padding: 8px;
      font-size: 14px;
    }
  </style>
</head>
<body>

<div class="card">
  <h2>ðŸ’¡ Safety Tip of the Day</h2>

  <p id="tipText">Loading...</p>

  <div id="editSection" style="display:none;">
    <textarea id="newTip"></textarea>
    <br>
    <button class="saveBtn" onclick="saveTip()">Save Tip</button>
  </div>

  <button id="editBtn" class="editBtn" style="display:none;" onclick="showEdit()">
    Edit Tip
  </button>
</div>


<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>

  const firebaseConfig = {
    apiKey: "AIzaSyDsFX7tQezhtJi6GkVBpZXn7YyJgZfyi7o",
    authDomain: "hse-connect-5b0a3.firebaseapp.com",
    projectId: "hse-connect-5b0a3",
    storageBucket: "hse-connect-5b0a3.firebasestorage.app",
    messagingSenderId: "1017230242361",
    appId: "1:1017230242361:web:66d427e171595aae5c53e8",
    measurementId: "G-2GGKDEJTKW"
  };

  firebase.initializeApp(firebaseConfig);

  const auth = firebase.auth();
  const db = firebase.firestore();

  let currentUserRole = "";
  let currentUserEmail = "";

  auth.onAuthStateChanged(async (user) => {

    if (!user) {
      window.location.href = "index.html";
      return;
    }

    currentUserEmail = user.email;

    // Get role from users collection
    const userDoc = await db.collection("users").doc(currentUserEmail).get();

    if (!userDoc.exists) {
      alert("No role assigned. Contact Admin.");
      window.location.href = "dashboard.html";
      return;
    }

    currentUserRole = userDoc.data().role;

    // Show edit button only for Admin
    if (currentUserRole === "Admin") {
      document.getElementById("editBtn").style.display = "inline-block";
    }

    loadTip();
  });


  async function loadTip() {
    const doc = await db.collection("settings").doc("safety_tip").get();

    if (doc.exists) {
      document.getElementById("tipText").innerText = doc.data().text;
    } else {
      document.getElementById("tipText").innerText = "No safety tip available.";
    }
  }

  function showEdit() {
    document.getElementById("editSection").style.display = "block";
  }

  async function saveTip() {

    const newText = document.getElementById("newTip").value;

    if (!newText) {
      alert("Tip cannot be empty.");
      return;
    }

    await db.collection("settings").doc("safety_tip").set({
      text: newText
    });

    alert("Safety Tip Updated Successfully");

    document.getElementById("editSection").style.display = "none";
    loadTip();
  }

</script>

</body>
</html>
